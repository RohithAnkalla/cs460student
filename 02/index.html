<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>CS460 â€“ A2 Cube Art</title>

    <script src="https://get.goXTK.com/xtk_edge.js"></script>
    <script src="./loader.js"></script>

    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        background: #000;
      }
      #r {
        width: 100%;
        height: 100%;
        background: #000;
      }
    </style>
  </head>
  <body>
    <div id="r"></div>

    <script>
      window.onload = function () {
        var r = new X.renderer3D();
        r.container = "r";
        r.init();
        window.r = r;

        r.bgColor = [0, 0, 0];
        r.backgroundColor = [0, 0, 0];

        const CUBE = 8;
        const GAP = 2;
        const STEP = CUBE + GAP;

        for (let iz = -5; iz < 6; iz++) {
          for (let iy = -5; iy < 6; iy++) {
            for (let ix = -5; ix < 6; ix++) {
              const c = new X.cube();

              c.lengthX = CUBE;
              c.lengthY = CUBE;
              c.lengthZ = CUBE;

              c.color = [1, 1, 1];
              c.opacity = 1;

              c.transform.translateX(STEP * ix);
              c.transform.translateY(STEP * iy);
              c.transform.translateZ(STEP * iz);

              r.add(c);
            }
          }
        }

        r.camera.position = [0, 0, 500];

        let SELECTED_CUBE = null;
        r.interactor.onMouseMove = function (event) {
          const cubeid = r.pick(event.offsetX, event.offsetY);
          if (cubeid != 0) SELECTED_CUBE = r.get(cubeid);
        };

        let spinning = false;

        window.addEventListener("keypress", function (e) {
          const k = e.key.toLowerCase();

          if (k === "q" && SELECTED_CUBE) {
            SELECTED_CUBE.visible = false;
          }

          if (k === "w" && SELECTED_CUBE) {
            SELECTED_CUBE.color = [Math.random(), Math.random(), Math.random()];
          }

          if (k === "e" && SELECTED_CUBE) {
            SELECTED_CUBE.transform.rotateX(10);
          }

          if (k === "b") {
            spinning = !spinning;
          }

          if (k === "o" && typeof download === "function") {
            download();
          }

          if (k === "l" && typeof upload === "function") {
            upload("scene.json");
          }
        });

        r.onRender = function () {
          if (spinning) r.camera.rotate([1, 0]);
        };

        r.render();
      };
    </script>
  </body>
</html>
